<div class="psdk-list-header">
  <div>
    <!-- <mat-form-field class="psdk-search" *ngIf="bShowSearch$">
      <mat-label><img class="psdk-icon-search" src="{{ searchIcon$ }}" /> <span class="psdk-search-label">Search</span> </mat-label>
      <input matInput id="search" (keyup)="applySearch($event)" placeholder="" />
    </mat-form-field> -->

    <div *ngIf="!bInForm$" class="psdk-outer-div-in-form">
      <div class="psdk-inner-div-in-form" *ngIf="bColumnReorder$">
        <div>
          <table
            mat-table
            id="list-view"
            [dataSource]="repeatList$"
            matSort
            cdkDropList
            cdkDropListOrientation="horizontal"
            (cdkDropListDropped)="drop($event)"
          >
            <ng-container *ngFor="let dCol of fields$" [matColumnDef]="dCol.config.name" sticky="true">
              <th mat-header-cell *matHeaderCellDef class="psdk-mat-header" (click)="_headerSortClick($event, dCol)" arrowPosition="before" cdkDrag>
                {{ dCol.config.label }}
                <div class="psdk-mat-header-filter">
                  <img class="psdk-filter-svg-icon" name="filterOnIcon" />
                </div>
                <div class="psdk-mat-header-arrow">
                  <img class="psdk-arrow-svg-icon" arrow="none" [attr.arrowid]="dCol.config.name" />
                </div>
                <div class="psdk-mat-header-button" (click)="$event.stopPropagation()">
                  <button mat-icon-button [matMenuTriggerFor]="groupMenu">
                    <img class="psdk-list-view-svg-icon" src="{{ menuSvgIcon$ }}" />
                  </button>
                  <mat-menu #groupMenu>
                    <button *ngIf="!_showUnGroupBy(dCol) && bGrouping$" mat-menu-item (click)="_groupBy($event, dCol)">
                      <img class="psdk-list-view-svg-icon" src="{{ groupBySvgIcon$ }}" /><span>Group By</span>
                    </button>
                    <button *ngIf="_showUnGroupBy(dCol) && bGrouping$" mat-menu-item (click)="_unGroupBy($event, dCol)">
                      <img class="psdk-list-view-svg-icon" src="{{ groupBySvgIcon$ }}" /><span>Ungroup</span>
                    </button>
                    <button mat-menu-item (click)="_filter($event, dCol)">
                      <img class="psdk-list-view-svg-icon" src="{{ filterSvgIcon$ }}" /><span>Filter</span>
                    </button>
                  </mat-menu>
                </div>
              </th>
              <td mat-cell *matCellDef="let element; index as i">
                <button
                  *ngIf="_showButton(dCol.config.name, dCol); else regular"
                  mat-button
                  color="primary"
                  (click)="_listViewClick(dCol.config, element)"
                >
                  {{ element[dCol.config.name] || '---' }}
                </button>
                <ng-template #regular>
                  {{ element[dCol.config.name] || '---' }}
                </ng-template>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns$; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns$"></tr>

            <!-- Group header -->
            <ng-container matColumnDef="groupHeader">
              <td mat-cell colspan="999" *matCellDef="let group">
                <mat-icon *ngIf="group.expanded" [attr.style]="_getIconStyle(group.level)">expand_less</mat-icon>
                <mat-icon *ngIf="!group.expanded" [attr.style]="_getIconStyle(group.level)">expand_more</mat-icon>
                <strong
                  >{{ _getGroupName(groupByColumns$[group.level - 1]) }}: {{ group[groupByColumns$[group.level - 1]] }} ({{
                    group.totalCounts
                  }})</strong
                >
              </td>
            </ng-container>

            <tr mat-row *matRowDef="let row; columns: ['groupHeader']; when: isGroup" (click)="_groupHeaderClick(row)"></tr>
          </table>
        </div>
      </div>
      <div class="psdk-inner-div-in-form" *ngIf="!bColumnReorder$">
        <div>
          <table mat-table id="list-view" [dataSource]="repeatList$" matSort>
            <ng-container *ngFor="let dCol of fields$" [matColumnDef]="dCol.config.name" sticky="true">
              <th mat-header-cell *matHeaderCellDef class="psdk-mat-header" (click)="_headerSortClick($event, dCol)" arrowPosition="before">
                {{ dCol.config.label }}
                <div class="psdk-mat-header-filter">
                  <img class="psdk-filter-svg-icon" name="filterOnIcon" />
                </div>
                <div class="psdk-mat-header-arrow">
                  <img class="psdk-arrow-svg-icon" arrow="none" [attr.arrowid]="dCol.config.name" />
                </div>
                <div class="psdk-mat-header-button" (click)="$event.stopPropagation()">
                  <button mat-icon-button [matMenuTriggerFor]="groupMenu">
                    <img class="psdk-list-view-svg-icon" src="{{ menuSvgIcon$ }}" />
                  </button>
                  <mat-menu #groupMenu>
                    <button *ngIf="!_showUnGroupBy(dCol) && bGrouping$" mat-menu-item (click)="_groupBy($event, dCol)">
                      <img class="psdk-list-view-svg-icon" src="{{ groupBySvgIcon$ }}" /><span>Group By</span>
                    </button>
                    <button *ngIf="_showUnGroupBy(dCol) && bGrouping$" mat-menu-item (click)="_unGroupBy($event, dCol)">
                      <img class="psdk-list-view-svg-icon" src="{{ groupBySvgIcon$ }}" /><span>Ungroup</span>
                    </button>
                    <button mat-menu-item (click)="_filter($event, dCol)">
                      <img class="psdk-list-view-svg-icon" src="{{ filterSvgIcon$ }}" /><span>Filter</span>
                    </button>
                  </mat-menu>
                </div>
              </th>
              <td mat-cell *matCellDef="let element; index as i">
                <button
                  *ngIf="_showButton(dCol.config.name, dCol); else regular"
                  mat-button
                  color="primary"
                  (click)="_listViewClick(dCol.config, element)"
                >
                  {{ element[dCol.config.name] || '---' }}
                </button>
                <ng-template #regular>
                  {{ element[dCol.config.name] || '---' }}
                </ng-template>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns$; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns$"></tr>

            <!-- Group header -->
            <ng-container matColumnDef="groupHeader">
              <td mat-cell colspan="999" *matCellDef="let group">
                <mat-icon *ngIf="group.expanded" [attr.style]="_getIconStyle(group.level)">expand_less</mat-icon>
                <mat-icon *ngIf="!group.expanded" [attr.style]="_getIconStyle(group.level)">expand_more</mat-icon>
                <strong
                  >{{ _getGroupName(groupByColumns$[group.level - 1]) }}: {{ group[groupByColumns$[group.level - 1]] }} ({{
                    group.totalCounts
                  }})</strong
                >
              </td>
            </ng-container>

            <tr mat-row *matRowDef="let row; columns: ['groupHeader']; when: isGroup" (click)="_groupHeaderClick(row)"></tr>
          </table>
        </div>
      </div>
    </div>
    <div *ngIf="bInForm$">
      <app-service-history
        *ngIf="payload.referenceList === 'D_ScheduleMaintenanceVisitList'"
        [heading]="configProps$.title"
        [data]="repeatListData"
      ></app-service-history>
      <!-- <app-service-team
        *ngIf="payload.referenceList === 'D_ServiceTeamList'"
        [heading]="configProps$.title"
        [data]="repeatListData"
      ></app-service-team>
      <app-driver-profiles
        *ngIf="payload.referenceList === 'D_DriverProfilesList'"
        [heading]="configProps$.title"
        [data]="repeatListData"
      ></app-driver-profiles> -->
    </div>
  </div>
</div>
